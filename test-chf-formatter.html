<!DOCTYPE html>
<html>
<head>
    <title>Test CHF Formatter</title>
    <style>
        body { font-family: monospace; padding: 20px; }
        .test-result { margin: 10px 0; padding: 10px; background: #f5f5f5; }
    </style>
</head>
<body>
    <h1>CHF Currency Formatter Test</h1>
    <div id="results"></div>
    
    <script type="module">
        // Simple format string parser for testing
        function processFormatSection(format, value) {
            console.log('Processing format:', format, 'with value:', value);
            
            // Remove all condition, color, and text transformation brackets to get the display format
            const cleanFormat = format.replace(/\[[^\]]+\]/g, '');
            console.log('Clean format:', cleanFormat);
            
            // Handle text in quotes
            const textMatches = cleanFormat.match(/"([^"]+)"/g) || [];
            let prefix = '';
            let suffix = '';
            let numberFormat = cleanFormat;
            
            textMatches.forEach(match => {
                console.log('Found quoted text:', match);
                const text = match.replace(/"/g, '');
                const index = cleanFormat.indexOf(match);
                const matchEnd = index + match.length;
                
                // Find where the number format starts (first occurrence of #, 0, @, or $)
                const numberStartMatch = cleanFormat.match(/[$#0@]/);
                const numberStart = numberStartMatch ? cleanFormat.indexOf(numberStartMatch[0]) : cleanFormat.length;
                
                if (index < numberStart) {
                    // Check if there's a space after the quoted text before the number format
                    if (matchEnd < cleanFormat.length && cleanFormat[matchEnd] === ' ' && numberStartMatch) {
                        prefix += text + ' ';
                        // Remove the quoted text AND the space after it
                        numberFormat = numberFormat.replace(match + ' ', '');
                    } else {
                        prefix += text;
                        // Remove just the quoted text
                        numberFormat = numberFormat.replace(match, '');
                    }
                } else {
                    suffix += text;
                    // Remove the quoted text from the format
                    numberFormat = numberFormat.replace(match, '');
                }
            });
            
            console.log('Prefix:', prefix);
            console.log('Number format:', numberFormat);
            console.log('Suffix:', suffix);
            
            // Format the number
            const numValue = typeof value === 'number' ? value : parseFloat(String(value));
            const displayValue = Math.abs(numValue);
            let formattedNumber = '';
            
            if (numberFormat.match(/[#0]/)) {
                const hasThousands = numberFormat.includes(',');
                const decimalMatch = numberFormat.match(/\.([0#]+)/);
                const decimals = decimalMatch ? decimalMatch[1].length : 0;
                
                if (hasThousands) {
                    formattedNumber = displayValue.toLocaleString('en-US', {
                        minimumFractionDigits: decimals,
                        maximumFractionDigits: decimals
                    });
                } else {
                    formattedNumber = displayValue.toFixed(decimals);
                }
            }
            
            // Add minus sign back if needed
            if (numValue < 0) {
                formattedNumber = '-' + formattedNumber;
            }
            
            const result = prefix + formattedNumber + suffix;
            console.log('Result:', result);
            return result;
        }
        
        // Test formats
        const testFormats = [
            '"CHF" #,##0.00',
            '"C$" #,##0.00',
            '"A$" #,##0.00',
            '"$" #,##0.00',
        ];
        
        const resultsDiv = document.getElementById('results');
        
        testFormats.forEach(format => {
            const div = document.createElement('div');
            div.className = 'test-result';
            
            const result1 = processFormatSection(format, 1234.56);
            const result2 = processFormatSection(format, -1234.56);
            
            div.innerHTML = `
                <strong>Format: ${format}</strong><br>
                1234.56 → ${result1}<br>
                -1234.56 → ${result2}<br>
                <small>Characters: [${result1.split('').map(c => c === ' ' ? 'SPACE' : c).join('][')}]</small>
            `;
            
            resultsDiv.appendChild(div);
        });
    </script>
</body>
</html>